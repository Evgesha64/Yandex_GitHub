# План проекта: Обучение с учителем - качество модели

## Описание задачи
Разработать решение для персонализации предложений постоянным клиентам интернет-магазина "В один клик" с целью увеличения их покупательской активности. Необходимо построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца.

## Поэтапный план выполнения

### Этап 1: Загрузка и первичный анализ данных

#### Шаг 1.1: Загрузка данных
- **Цель**: Загрузить все необходимые файлы данных
- **Действия**:
  - Загрузить `market_file.csv` (основные данные о клиентах)
  - Загрузить `market_money.csv` (данные о выручке по периодам)
  - Загрузить `market_time.csv` (данные о времени на сайте)
  - Загрузить `money.csv` (данные о прибыльности клиентов)
- **Ожидаемый результат**: 4 загруженных датафрейма
- **Критерии успеха**: Все файлы загружены без ошибок, данные соответствуют описанию

#### Шаг 1.2: Первичная проверка данных
- **Цель**: Убедиться в корректности загруженных данных
- **Действия**:
  - Проверить размеры датафреймов
  - Изучить типы данных в каждом столбце
  - Выявить пропущенные значения
  - Проверить уникальность ID клиентов
- **Ожидаемый результат**: Отчет о структуре и качестве данных
- **Критерии успеха**: Выявлены все проблемы с данными, определены стратегии их решения

### Этап 2: Предобработка данных

#### Шаг 2.1: Обработка пропущенных значений
- **Цель**: Устранить или заполнить пропущенные значения
- **Действия**:
  - Проанализировать паттерны пропусков
  - Выбрать стратегию заполнения (медиана, мода, удаление)
  - Применить выбранную стратегию
- **Ожидаемый результат**: Датафреймы без пропущенных значений
- **Критерии успеха**: Сохранена максимальная информация при устранении пропусков

#### Шаг 2.2: Обработка выбросов
- **Цель**: Выявить и обработать аномальные значения
- **Действия**:
  - Построить boxplot для числовых признаков
  - Применить IQR метод для выявления выбросов
  - Принять решение о стратегии обработки (удаление, трансформация, оставление)
- **Ожидаемый результат**: Очищенные от выбросов данные
- **Критерии успеха**: Устранены явные аномалии, сохранена репрезентативность данных

#### Шаг 2.3: Кодирование категориальных признаков
- **Цель**: Преобразовать категориальные признаки в числовые
- **Действия**:
  - Идентифицировать категориальные признаки
  - Применить Label Encoding для бинарных признаков
  - Применить One-Hot Encoding для многоклассовых признаков
- **Ожидаемый результат**: Все признаки в числовом формате
- **Критерии успеха**: Сохранена информация о категориях, нет потери данных

### Этап 3: Исследовательский анализ данных (EDA)

#### Шаг 3.1: Анализ целевой переменной
- **Цель**: Понять распределение целевого признака
- **Действия**:
  - Построить гистограмму распределения классов
  - Вычислить баланс классов
  - Проанализировать связь с другими признаками
- **Ожидаемый результат**: Понимание дисбаланса классов и его влияния
- **Критерии успеха**: Определена стратегия работы с дисбалансом

#### Шаг 3.2: Анализ числовых признаков
- **Цель**: Изучить распределения и взаимосвязи числовых признаков
- **Действия**:
  - Построить гистограммы для каждого числового признака
  - Вычислить описательные статистики
  - Построить корреляционную матрицу
  - Создать pairplot для ключевых признаков
- **Ожидаемый результат**: Понимание распределений и корреляций
- **Критерии успеха**: Выявлены ключевые паттерны в данных

#### Шаг 3.3: Анализ категориальных признаков
- **Цель**: Изучить распределения категориальных признаков
- **Действия**:
  - Построить barplot для каждого категориального признака
  - Проанализировать связь с целевой переменной
  - Выявить доминирующие категории
- **Ожидаемый результат**: Понимание влияния категорий на целевую переменную
- **Критерии успеха**: Выявлены значимые категории

#### Шаг 3.4: Фильтрация клиентов
- **Цель**: Отобрать клиентов с активностью не менее 3 месяцев
- **Действия**:
  - Определить критерии активности (наличие покупок в 3+ месяцах)
  - Применить фильтрацию к данным
  - Проанализировать влияние фильтрации на размер выборки
- **Ожидаемый результат**: Отфильтрованная выборка активных клиентов
- **Критерии успеха**: Сохранены только релевантные клиенты

### Этап 4: Объединение таблиц

#### Шаг 4.1: Подготовка данных для объединения
- **Цель**: Подготовить данные из разных таблиц к объединению
- **Действия**:
  - Преобразовать данные о выручке в широкий формат (отдельные столбцы для каждого периода)
  - Преобразовать данные о времени в широкий формат
  - Проверить соответствие ID между таблицами
- **Ожидаемый результат**: Готовые к объединению таблицы
- **Критерии успеха**: Все ID соответствуют, нет потери данных

#### Шаг 4.2: Объединение таблиц
- **Цель**: Создать единую таблицу для моделирования
- **Действия**:
  - Объединить market_file с данными о выручке
  - Добавить данные о времени на сайте
  - Проверить целостность объединенных данных
- **Ожидаемый результат**: Единая таблица со всеми признаками
- **Критерии успеха**: Все клиенты имеют полную информацию

### Этап 5: Корреляционный анализ

#### Шаг 5.1: Анализ мультиколлинеарности
- **Цель**: Выявить и устранить мультиколлинеарность
- **Действия**:
  - Вычислить корреляционную матрицу для числовых признаков
  - Построить heatmap корреляций
  - Выявить пары признаков с высокой корреляцией (>0.8)
  - Принять решение об удалении избыточных признаков
- **Ожидаемый результат**: Набор признаков без мультиколлинеарности
- **Критерии успеха**: Максимальная корреляция между признаками <0.8

### Этап 6: Построение и обучение моделей

#### Шаг 6.1: Подготовка данных для обучения
- **Цель**: Подготовить данные для обучения моделей
- **Действия**:
  - Разделить данные на признаки (X) и целевую переменную (y)
  - Разделить данные на обучающую и тестовую выборки (80/20)
  - Применить стратифицированное разделение для сохранения баланса классов
- **Ожидаемый результат**: Готовые обучающие и тестовые выборки
- **Критерии успеха**: Сохранен баланс классов в обеих выборках

#### Шаг 6.2: Создание пайплайнов
- **Цель**: Создать пайплайны для обработки данных и обучения моделей
- **Действия**:
  - Создать ColumnTransformer для раздельной обработки числовых и категориальных признаков
  - Настроить кодировщики для категориальных признаков (LabelEncoder, OneHotEncoder)
  - Настроить скейлеры для числовых признаков (StandardScaler, MinMaxScaler)
  - Создать пайплайны для каждой модели
- **Ожидаемый результат**: Готовые пайплайны для всех моделей
- **Критерии успеха**: Пайплайны корректно обрабатывают все типы признаков

#### Шаг 6.3: Обучение базовых моделей
- **Цель**: Обучить четыре базовые модели
- **Действия**:
  - Обучить KNeighborsClassifier
  - Обучить DecisionTreeClassifier
  - Обучить LogisticRegression
  - Обучить SVC
  - Вычислить базовые метрики для каждой модели
- **Ожидаемый результат**: Обученные модели с базовыми метриками
- **Критерии успеха**: Все модели успешно обучены

#### Шаг 6.4: Выбор метрики и обоснование
- **Цель**: Выбрать подходящую метрику для задачи
- **Действия**:
  - Проанализировать специфику задачи (предсказание снижения активности)
  - Рассмотреть precision, recall, F1-score, ROC-AUC
  - Обосновать выбор метрики с точки зрения бизнеса
  - Выбрать основную метрику для оптимизации
- **Ожидаемый результат**: Обоснованный выбор метрики
- **Критерии успеха**: Выбор метрики соответствует бизнес-целям

#### Шаг 6.5: Подбор гиперпараметров
- **Цель**: Найти оптимальные гиперпараметры для каждой модели
- **Действия**:
  - Настроить GridSearchCV или RandomizedSearchCV
  - Подобрать гиперпараметры для каждой модели
  - Использовать кросс-валидацию для надежной оценки
  - Выбрать лучшую модель по выбранной метрике
- **Ожидаемый результат**: Оптимизированные модели с лучшими параметрами
- **Критерии успеха**: Значительное улучшение метрик по сравнению с базовыми моделями

### Этап 7: Анализ важности признаков

#### Шаг 7.1: Оценка важности признаков
- **Цель**: Понять, какие признаки наиболее важны для модели
- **Действия**:
  - Применить SHAP для анализа важности признаков
  - Построить график важности признаков
  - Проанализировать вклад каждого признака в предсказания
- **Ожидаемый результат**: Ранжированный список важности признаков
- **Критерии успеха**: Четкое понимание влияния признаков на модель

#### Шаг 7.2: Интерпретация результатов
- **Цель**: Сделать выводы о значимости признаков
- **Действия**:
  - Выявить наименее значимые признаки
  - Определить наиболее влиятельные признаки
  - Сформулировать рекомендации для бизнеса
- **Ожидаемый результат**: Практические выводы о признаках
- **Критерии успеха**: Выводы применимы для бизнес-решений

### Этап 8: Сегментация покупателей

#### Шаг 8.1: Создание сегментов
- **Цель**: Выделить группы клиентов для персонализации
- **Действия**:
  - Использовать предсказания модели для выделения групп риска
  - Объединить с данными о прибыльности клиентов
  - Создать сегменты на основе вероятности снижения активности и прибыльности
  - Визуализировать сегменты
- **Ожидаемый результат**: Четко определенные сегменты клиентов
- **Критерии успеха**: Сегменты имеют различающиеся характеристики

#### Шаг 8.2: Анализ выбранного сегмента
- **Цель**: Детально изучить выбранный сегмент
- **Действия**:
  - Выбрать один сегмент для детального анализа
  - Провести графическое исследование характеристик сегмента
  - Проанализировать поведенческие паттерны
  - Выявить специфические особенности сегмента
- **Ожидаемый результат**: Глубокое понимание выбранного сегмента
- **Критерии успеха**: Выявлены ключевые особенности и проблемы сегмента

#### Шаг 8.3: Разработка рекомендаций
- **Цель**: Создать персонализированные предложения для сегмента
- **Действия**:
  - На основе анализа сегмента разработать рекомендации
  - Предложить конкретные маркетинговые действия
  - Обосновать эффективность предложений
  - Создать план внедрения рекомендаций
- **Ожидаемый результат**: Конкретные рекомендации для бизнеса
- **Критерии успеха**: Рекомендации обоснованы данными и применимы на практике

### Этап 9: Финальный анализ и выводы

#### Шаг 9.1: Создание итогового отчета
- **Цель**: Обобщить все результаты проекта
- **Действия**:
  - Описать задачу и подход к решению
  - Обобщить результаты предобработки данных
  - Представить результаты моделирования
  - Описать выбранную лучшую модель
  - Представить рекомендации по сегментам
- **Ожидаемый результат**: Полный отчет о проекте
- **Критерии успеха**: Отчет содержит все ключевые результаты и выводы

#### Шаг 9.2: Оценка качества решения
- **Цель**: Оценить качество и применимость решения
- **Действия**:
  - Проанализировать метрики качества модели
  - Оценить практическую применимость рекомендаций
  - Выявить ограничения решения
  - Предложить направления для улучшения
- **Ожидаемый результат**: Критическая оценка решения
- **Критерии успеха**: Честная оценка с предложениями по улучшению

## Критерии успеха проекта

1. **Качество данных**: Все данные корректно загружены и предобработаны
2. **Качество модели**: Модель показывает хорошие метрики на тестовых данных
3. **Интерпретируемость**: Результаты модели понятны и применимы для бизнеса
4. **Практичность рекомендаций**: Предложения по сегментам реализуемы
5. **Документированность**: Все шаги задокументированы с выводами

## Ожидаемые результаты

- Модель машинного обучения для предсказания снижения активности клиентов
- Анализ важности признаков для понимания факторов риска
- Сегментация клиентов с персонализированными рекомендациями
- Полный отчет с выводами и рекомендациями для бизнеса

